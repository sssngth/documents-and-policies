# Lido on Ethereum Standard Node Operator Protocol - Block Proposals

```markdown!
STATUS: V3.0
```

## A - Purpose
This Standard Node Operator Protocol (SNOP) outlines the standards, Auxiliary Proposer Mechanisms (APMs) and infrastructure available for block proposals in Ethereum (see [Appendix A](#appendix-a---ethereum-standards-auxiliary-proposer-mechanisms--infrastructure)), the rules around the usage of this SNOP, the considerations that guide the expectations of the Lido on Ethereum protocol ("Lido") with regard to block proposals and APMs, the responsibilities Node Operators (NOs) using Lido have in performing block proposals, providing APMs and distributing the associated rewards to stakers, and the actions that NOs can expected in case of non-conformance with this SNOP.

## B - Scope
This SNOP applies to Lido, the NOs who use one or more of the [Staking Router (SR)'s](https://docs.lido.fi/contracts/staking-router) [Curated Module (CM)](https://operatorportal.lido.fi/modules/curated-module), [Simple Distributed Validator Technology Module (SDVTM)](https://operatorportal.lido.fi/modules/simple-dvt-module), [Community Staking Module (CSM)](https://operatorportal.lido.fi/modules/community-staking-module), future Staking Module (SM) or avenue, and the validators the NOs operate as part of the protocol.

The below stipulated operational flows and expectations apply to all above-mentioned SMs, except in cases where specific mentions are made to alternate flows or expectations for specific SMs due to differences in their technical or operational characteristics.

**_NOTE:_** As terms can have different meanings based on how they are used and in different contexts, the below table aims to clarify the usage of various terms for the purposes of this SNOP and how they apply within the context of Lido.

Term|Definition|Context
:---:|---|---
Node Operator|An entity, individual, or set thereof who operate(s) nodes while using one or more of Lido's SMs to run Ethereum validators|CM & CSM solo operation:</br>A single entity or individual operating validators</br>SDVTM operation:</br>A cluster of independent entities and/or individuals operating validators as a group</br>CSM DVT operation:</br>An entity, individual, or cluster thereof operating validators
Validator|A validator, also referred to as a "key" in this SNOP, is the technical component of participating in Ethereum's consensus, that - if active - represents a `MAX_EFFECTIVE_BALANCE` ("stake weight") of between 32 and 2048 ETH, is controlled by a public-private validator signing key pair and performs duties for the network -- attesting to and proposing new blocks, participating in sync committees, and reporting network violations of the slashing rules|CM & CSM solo operation:</br>A validator run by a single NO</br>SDVTM operation:</br>A Distributed Validator (DV) run by a cluster of independent NOs utilizing [Distributed Validator Technology (DVT)](https://ethereum.org/en/staking/dvt/#distributed-validator-technology)</br>CSM DVT operation:</br>A DV run by a single NO or cluster utilizing DVT

## C - Guiding Considerations
Constituted in the [Lido DAO Vibe](https://snapshot.org/#/s:lido-snapshot.eth/proposal/0x739fbe56425d355b5e41c22bb346b7a8217afd9e84aa49863648b1c641a482e3) and iterated upon by the community in a regularly performed [Guided Open Objective Setting Exercise (GOOSE)](https://snapshot.org/#/s:lido-snapshot.eth/proposal/0x58bbc5d540e46081043ef29d4d1ee56b7df4dc1b0369aa78e0c15a2403549353), Lido strives to contribute to the decentralization, accessibility, and censorship resistance of Ethereum through the provision of simple and secure staking for the ecosystem. The following guiding considerations for the expectations, practical implementation, and utilization of Lido are derived from these overarching goals.

### C.1 - Economic Security
Outlined in [Hasu's proposal on Maximal Extractable Value (MEV)](https://research.lido.fi/t/proposal-optimal-mev-policy-for-lido/2489), the game-theoretical best approach for Lido to preserve the security of Ethereum's Proof-of-Stake (PoS) consensus against 51% attacks, stakers' low threshold access to Decentralized Finance (DeFi), and the positive impact that the protocol can have on the network through efforts towards the decentralization and censorship resistance of the validator set, is by optimizing for Lido's economic competitiveness.

Pursuing this goal primarily calls for the maximization of the protocol's staking APR by enabling NOs using Lido to fulfill the Ethereum validator duties - attesting to and proposing new blocks, participating in sync committees, and reporting network violations of the slashing rules - as reliably, timely, correctly, and free of slashable offenses as possible.

Beyond that, the leading adoption of the latest native and Ethereum-aligned standards, infrastructure, and developments that have the potential to profoundly change the staking landscape and/or impact stakers economically should be continued.

Unlike rewards for the fulfillment of duties on the Consensus Layer (CL), the compensations for services on the Execution Layer (EL) are not automatically issued to a validator's account by the Ethereum protocol, but accrue on an NO-determined address -- e.g. in the form of MEV extracted and [priority fees](https://ethereum.org/en/developers/docs/gas/#priority-fee) sent by users to incentivize the inclusion of their transactions. This architecture carries the risk that NOs using Lido could try to hide EL rewards directly received in an attempt to earn more than their rightful share of the protocol's smoothed rewards. In the best interest of stakers and honest NOs, rewards stealing in Lido must be as prohibitively difficult to conceal and expensive to execute as possible. Irrespective if for a [bonded SM](https://operatorportal.lido.fi/modules/community-staking-module#block-88e6d7eca6364a758541dc1ee66a278f) such as CSM, with by design more options for automated enforcement of rules, or a module based on social reputation -- to ensure fair conditions in all SMs, it is essential to continuously and transparently monitor NO behavior around block proposals and rewards distribution. For this purpose, a multitude of community-built open-source [tools](https://operatorportal.lido.fi/existing-operator-portal/ethereum-onboarding/no-resources-tooling) and [dashboards](https://operatorportal.lido.fi/operator-statistics-and-metrics) are available for Lido.

In the context of APMs, attention is to be paid to the careful consideration of potential implications the implementation of new mechanisms into the protocol may have on the block construction and proposal value chain, and that any benefits that may be gained in certain areas are measured against potential losses in others -- specifically with respect to the resulting value of blocks proposed by NOs using Lido.

### C.2 - Decentralization
Decentralization is one of the core values of the Lido DAO and its prevalence, just like that of economic security, an integral premise for the robustness of the Ethereum network -- comparatively only in a more technical-operational sense. For this reason, the hitherto outlined optimization of Lido solely for economic security must be expanded and weighed up with aspects of decentralization to provide the holistic guidance this SNOP seeks to offer.

Diverse setups, i.a., in terms of the geographic dispersion, infrastructure and clients utilized to run nodes, are critical to proactively mitigate risks of local outages, isolated bugs, and to globally reduce Ethereum p2p latencies. NOs using Lido are encouraged to drive the sustained efforts to achieve those goals and are thus afforded a performance margin that allows even those from underrepresented regions and such with setups that are not primarily geared towards rewards maximization to equitably participate and valuably contribute to the system.

For the Lido community, the ongoing improvement of Ethereum is at the heart of all interests. Therefore, the active involvement in discussions on the latest developments and their directional introduction into Lido should continue, so that in the process of sensitive transformations the network can remain to count on the assistance of a broad set of well-coordinated and proficient NOs.

Another important aspect of decentralization is credible neutrality. For Lido, this means that not only the first available or most popular implementation of an APM should be supported by the protocol, but any solution that is not in conflict with the spirit of Ethereum or this SNOP, demonstrably strives for the goals intended by the authors of the underlying standard(s), whose inclusion was publicly proposed - e.g. on the [Lido Research Forum](https://research.lido.fi/) - and whose technology has been thoroughly tested.

### C.3 - Censorship Resistance
A third attribute of key importance to Ethereum, and a factor for Lido to balance the dimensions of economic security and decentralization against, is censorship resistance.

Even with the current form of out-of-protocol proposer-builder separation (PBS) and the resulting dissolution of the validators' former monopoly over transaction inclusion and ordering (see [Appendix A.4.1 ff](#a41---proposer-builder-separation)), Ethereum users can still be censored at various points along the block construction and proposal pipeline. In fact, [it has been shown](https://censorship.pics/) that recently it is most rarely the validators that do not propose blocks that include transactions from certain addresses, but rather builders that disregard them when constructing payloads and/or relays that refuse to broadcast such to the network, that cause [censorship latency ("inclusion delay")](https://eth.neutralitywatch.com/). Of course, though, there are also validators that are only connected to censoring relays and/or do not take all transactions into account when building local blocks (see [Appendix A.3](#a3---local-block-building)).

As outlined in section decentralization (see [C.2](#c2---decentralization)), for the operational health of Ethereum, Lido should foster credible neutrality, which - in regards to the users - logically extends to the rejection of the censorship of transactions. Every user who respects the rules of the network should be able to participate in the public good that is Ethereum without restrictions. It is acknowledged that some NOs using Lido are not able to provide unrestricted access to the network due to the regulatory requirements of the jurisdictions they operate in, yet all NOs are called upon to continually seek to push the boundaries towards greater freedom through thought leadership and exemplary behavior.

## D - Node Operator Responsibilities
Based on the guiding considerations, the following responsibilities arise for the NOs using Lido in respect to the configuration of their validators for the purpose of proposing blocks, and the minimum expected EL performance when fulfilling fundamental Ethereum duties as well as optional APM services. Moreover, this section outlines which consequences the NOs can expect in the event of non-conformance with this SNOP and in which cases the measures taken might differ between SMS due to their technical or operational differences.

### D.1 - Fee Recipient
To protect the economic competitiveness of Lido, rewards stealing must be prevented.

It is the responsibility of each NO using Lido, at all active duty times, to have configured in the CC, VC and/or signing service of choice, for each validator run for the protocol, regardless of SM, but depending on whether a key is operated on [Mainnet](https://docs.lido.fi/deployed-contracts/), [Holešky](https://docs.lido.fi/deployed-contracts/holesky/) or [Sepolia](https://docs.lido.fi/deployed-contracts/sepolia/), the `LidoExecutionLayerRewardsVault` as the `fee_recipient` for the block rewards, comprising of the priority fees received from user for transaction inclusion, the MEV extracted through PBS and the compensations for optional APM services provided.

Proposals of blocks that get flagged by monitoring because of their unknown fee recipient (FR), indicate the potential misconfiguration of an NO's validator(s).

In cases of an NO of the CM or SDVTM, contributors to NOM will reach out to the NO and ask for a clarification of the situation. If force majeure can be ruled out as the cause of the incident and no other plausible explanation can be provided, it must be assumed that the FR has been incorrectly configured by the NO and the proposed block's rewards have been stolen. Consequently, depending on the severity of the offense, contributors may consider raising a formal issue with the NO on the Lido Research Forum, requesting remediative action, and seeking the reimbursement of the stolen rewards.

In cases of an NO of the CSM, upon detection of a proposal with an unknown FR, an amount of the affected NO's bond equal to the block rewards and an additional disincentive of 0.1 ETH is locked for 8 weeks, and the NO is afforded a challenge period to discuss the situation in the [CSM Support category](https://research.lido.fi/c/csm-support/21) of the Lido Research Forum. Once the NO compensates Lido for the incident or upon expiry of the challenge period, if an agreement has been reached with the community that force majeure was the cause of the event, the lock on the bond is lifted. If otherwise neither an agreement can be reached, nor a compensation is being paid, the CSM Committee will initiate an [Easy Track motion](https://lido.fi/governance#easy-track) to propose to the Lido DAO that the locked portion of the NO's bond be burned as a penalty. Any of the NO's validators that fail to provide a full bond - i.e. become unbonded - as a result of this measure are [requested to exit the protocol](https://lido.mypinata.cloud/ipfs/QmZTMfmJZsYHz61f2FjhYdh5VNu6ifjYQJzYUGkysHs8Uu). If the requested validators are not exited, they are marked stuck, and no operator rewards are distributed to the NO until the stuck keys are exited.

**_NOTE:_** After the implementation of [EIP-7002: Execution Layer Triggerable Withdrawals](https://eips.ethereum.org/EIPS/eip-7002) into Lido, stuck validators will instead be forcefully ejected at the protocol level.

### D.2 - MEV Boost Relay Allowed List
To foster Ethereum's decentralization and empower NOs who would otherwise not be able to economically viable compete with actors who pursue sophisticated strategies for maximal extraction of MEV, Lido supports out-of-protocol PBS according to the MEV-Boost specification (see [Appendix A.4.1 ff](#a41---proposer-builder-separation)). To ensure their reliability and values-alignment with Ethereum, each relay applying to serve Lido undergoes a vetting process by the [Relay Maintenance Committee (RMC)](https://research.lido.fi/t/lido-on-ethereum-identify-and-constitute-relay-maintenance-committee/3386).

It is the responsibility of each NO using Lido, at all active duty times, to have configured in the CC or out-of-protocol PBS sidecar of choice, for each validator run for the protocol, regardless of SM, but depending on whether a key is operated on [Mainnet](https://etherscan.io/address/0xf95f069f9ad107938f6ba802a3da87892298610e#readContract) or [Holešky](https://holesky.etherscan.io/address/0x2d86C5855581194a386941806E38cA119E50aEA3#readContract), the address(es) of at least one vetted relay labeled “must use some”, as well as any number of entries labeled "may use" of the MEV Boost Relay Allowed List - found on the [Node Operator Portal](https://enchanted-direction-844.notion.site/6d369eb33f664487800b0dedfe32171e?v=d255247c822c409f99c498aeb6a4e51d) or by querying the `get_relays` method of the respective smart contract.

Proposals of blocks that get flagged by monitoring because of their unknown payload source (PS), or - aside from locally built ones - exclusively of blocks whose payloads were sourced from relays labeled “may use”, although early in the relevant slots there were more valuable payloads available via relays labeled “must use some”, indicate the potential misconfiguration of an NO's validator(s).

In cases of an NO of the CM or SDVTM, contributors to the Node Operator Mechanisms (NOM) workstream of the Lido DAO will reach out to the NO and ask for a clarification of the situation. If force majeure can be ruled out as the cause of the incident and no other plausible explanation can be provided, it must be assumed that an unvetted relay has been configured by the NO or that the “must use some” selection has been ignored. Consequently, depending on the severity of the offense, contributors may consider raising a formal issue with the NO on the Lido Research Forum, requesting remediative action, and seeking the reimbursement of missed rewards.

In cases of an NO of the CSM, the approach is basically the same, with the two exceptions that reaching the NO is only possible if a contact was voluntarily shared with the community, and that instead of contributors to NOM such to the [Community Staking Module Committee](https://research.lido.fi/t/community-staking-module-committee/8333) will reach out to the NO.

**_NOTE:_** For CSMv2, an automation of measures in response to offences is being contemplated.

# Appendix
## Appendix A - Ethereum Standards, Auxiliary Proposer Mechanisms & Infrastructure
### A.1 - Advancing Ethereum's State
Advancing Ethereum's state revolves around attaching new blocks of information to the blockchain and begins with the PoS consensus pseudo-randomly assigning the block proposal duty for an upcoming slot to one of the active validators. Once the assigned slot arrives, the validator compiles a [plurality of CL and EL data](https://ethereum.org/en/developers/docs/blocks/#block-anatomy) into a block, signs, and broadcasts it to the network. The other validators then check the proposed block and, if the required supermajority attests to its validity, it is appended to the blockchain, updating the global state.

Sometimes a validator fails to propose a block -- the slot then remains empty, the state of Ethereum unchanged, and the affected block is referred to as missed. Another exceptional case is a block that is temporarily part of the blockchain, but replaced by another block before finalization through mechanisms such as reorganizations ("reorgs") or forks of Ethereum's [Gasper consensus algorithm](https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/gasper/). This can happen, e.g., because the block was proposed to the network too late to reach and obtain the attestations of a sufficient amount of validators, because the chain split due to changes in the protocol rules or because of a community disagreement about the future of Ethereum. Blocks that are abandoned during finalization are called orphans.

### A.2 - Beacon Node API
[Application programming interface (API)](https://ethereum.github.io/beacon-APIs) exposed by beacon nodes (BNs) - either as consensus client (CC) or validator client (VC) - to query and participate in the Beacon Chain (BC) according to [Ethereum's consensus specification](https://github.com/ethereum/consensus-specs). The Beacon Node API is important for this SNOP both as the standard required to enable nodes to fulfill fundamental validator duties and to allow NOs using Lido to customize their block proposal setups.

### A.3 - Local Block Building
In local block building, the validator assigned for the proposal duty of a slot selects the transactions to be included in the block from the local mempool of its execution client (EC) and orders them to its preference. In this process, the transactions can originate from the validator itself, from users who sent them to the validator for inclusion, or from Ethereum's public mempool. The EC has access to the latter by participating in the EL gossip network, which allows the EC to collect transactions for its local mempool that are broadcast by other validators that have verified the validity of those transactions by successfully executing them on their local nodes.

In the assigned slot and initiated by a request of its CC, the validator selects the transactions to be included, also taking into account the block's gas limit. The EC then locally executes the selected transactions in the specified order to obtain an updated state tree, whose root it sends to the CC along a list of the included transactions -- the execution payload. Following this, the CC takes the state root and execution payload received, and together with a range of additional data, wraps them into a block. In further steps, the block is forwarded to the VC handling the validator's private key for signing, and back to the CC for broadcasting to the network via the gossip protocol of the CL, so that finally the other validators can check the block's validity and vote on its appending. A block locally built by a validator is often referred to as vanilla.

### A.4 - Auxiliary Proposer Mechanisms
APMs refer to supplementary mechanisms that validators can leverage to optimize the process of block proposals. These mechanisms are typically designed to enhance proposer decision-making, improve network efficiency, and capture additional value while maintaining alignment with Ethereum's core principles.

APMs can include block-building pipelines, block auctions, proposer commitments, or other innovations that introduce optimizations for transaction inclusion and ordering.

The following APM framework provides a structured way to understand how block proposers can extend their default functionality using external mechanisms. It consists of three key components:

- Mechanisms, which define the high-level objectives -- e.g. block auctioning in PBS
- Protocols, which specify the rules governing the interactions between agents -- e.g. MEV-Boost protocol for out-of-protocol PBS
- Sidecars, which are software implementations enabling the participation in these protocols -- e.g. MEV-Boost as client-side relay tool

The framework allows for flexibility, as a single mechanism can have multiple protocol implementations, each supported by different sidecars.

#### A.4.1 - Proposer-Builder Separation
[PBS](https://notes.ethereum.org/@vbuterin/pbs_censorship_resistance) is a mechanism designated to solve the increasing complexity of Ethereum block proposals and the risk of their centralization in the hands of actors able to pursue more sophisticated strategies to extract MEV than the common validator can afford -- exacerbating inequalities and running counter to the decentralization efforts of the ecosystem. PBS adresses this by separating two authorities that originally fell to the validator -- building the execution payloads and proposing the blocks for slots assigned by the protocol. The separation of roles reduces the complexity for the proposer, who - in contrast to local block building (see [Appendix A.3](#a3---local-block-building)) - only has to select the highest bid of specialized third-party builders competing for the construction of a slot's most valuable execution payload, wrap that payload in a block, and propose it to the network. Thanks to the auctioning of the payload construction to builders with extensive means and, in addition to the public mempool, access also to lucrative private order flows, every participant benefits from the application of PBS. Ethereum from ensuring that even validators with limited resources can fulfill the block proposal duty and actively contribute to the security of the network, as well as builders and relays - the facilitators of the interaction between builders and proposers - who all economically profit from the optimized extraction of MEV. In Lido, this also extends to stakers, who receive the lion's share of the rewards accrued from staking the deposits to the system.

##### A.4.1.1 - Out-Of-Protocol PBS
In general, out-of-protocol implementations serve as functional equivalents and/or supplements to Ethereum in-protocol APMs. In the case of PBS, which - while being discussed since The Merge - has not yet been natively introduced to the protocol due to the extensive changes it would required to the consensus, out-of-protocol implementations represent the only available options until the arrival of, e.g., [enshrined proposer-builder separation (ePBS)](https://eips.ethereum.org/EIPS/eip-7732).

##### A.4.1.2 - MEV-Boost
[MEV-Boost](https://boost.flashbots.net/) is [Flashbot's reference design proposal](https://ethresear.ch/t/mev-boost-merge-ready-flashbots-architecture/11177) for a [PBS-friendly MEV marketplace](https://ethresear.ch/t/proposer-block-builder-separation-friendly-fee-market-designs/9725), whose architecture served as basis for the specification of Ethereum's Builder API (see [Appendix A.4.1.3](#a413---builder-api)). By making the optimized extraction of MEV accessible to all operators with the distribution of an open source validator sidecar that automatically selects the highest bid for a slot's execution payload auction and permissionlessly handles the orchestration of a block proposer's interactions with builders and relays via the Beacon and Builder APIs, the MEV-Boost implementation has become the de facto standard for out-of-protocol PBS in Ethereum.

MEV-Boost has also addressed concerns about the weakness of PBS in terms of protecting Ethereum's censorship resistance that had already been expressed for in-protocol variants. The [minimum bid value ("min-bid")](https://www.flashbots.net/#9f18e7f297d6443c895d870df3ee5d2a) is a setting that allows proposers to forego a small amount of rewards and instead of sourcing externally constructed execution payloads for slots where the highest bid is below the min-bid configured by the proposer, create payloads locally -- ensuring the inclusion of otherwise censored transactions.

##### A.4.1.3 - Builder API

##### A.4.1.4 - Sidecars

### A.5 - APM Infrastructure

#### A.5.1 - Out-Of-Protocol PBS Builders & Relays

##### A.5.1.1 - Troubleshooting

##### A.5.1.2 - Responsibilities & Incident Management
